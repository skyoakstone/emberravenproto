<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ember Raven ‚Äì Your Personal Resource Navigator</title>

<style>
/* ===========================
   WIREFRAME GRAYSCALE THEME
   =========================== */

/* Neutral palette tokens */
:root{
  --bg:#ffffff;          /* page background */
  --card:#ffffff;        /* card/surface background */
  --text:#111111;        /* primary text (near-black) */
  --muted:#666666;       /* secondary text */
  --border:#d9d9d9;      /* dividers & outlines */
  --surface:#f6f6f6;     /* subtle panels / section bg */

  /* Keep these for component states, but grayscale */
  --accent:#111111;      /* used for outlines/primary CTA bg */
  --accent-2:#111111;    /* link color (will be underlined) */
  --accent-3:#333333;    /* spare neutral accent */
  --danger:#333333;      /* neutralized ‚Äúdanger‚Äù */
  --chip:#f3f3f3;        /* chip bg */
}

/* Base layout/typography */
*{box-sizing:border-box}
body{
  margin:0; background:var(--bg); color:var(--text);
  font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Roboto,Roboto;
}
a{
  color:var(--text);
  text-decoration:underline; /* keep affordance in monochrome */
}

/* Containers */
header, .container{max-width:980px; margin:0 auto; padding:16px}
header{
  display:flex; align-items:center; gap:12px; justify-content:space-between;
  border-bottom:1px solid var(--border);
}
.logo{display:flex; align-items:center; gap:8px; font-weight:700}
.logo .icon{font-size:24px}
.nav{display:flex; gap:16px; font-size:14px; color:var(--muted)}
.hero{padding:24px 16px}

/* Headings/text */
h1{font-size:28px; margin:0 0 8px}
.sub{color:var(--muted); margin-bottom:16px}

/* Address block */
.address{
  display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:20px;
}
.input{
  background:#fff; border:1px solid var(--border); color:var(--text);
  padding:12px 14px; border-radius:10px; min-width:260px; flex:1;
}

/* Buttons */
.btn{
  background:#eaeaea; color:var(--text); border:1px solid var(--border);
  padding:12px 16px; border-radius:10px; font-weight:700; cursor:pointer;
}
.btn.secondary{background:#fff; color:var(--text); border:1px solid var(--border)}
.btn.small{padding:10px 12px; font-size:14px; border-radius:10px}
.btn.ghost{background:transparent; color:var(--text); border:1px solid var(--border)}
.btn:hover{filter:brightness(.97)}

/* Grid & cards */
.grid{
  display:grid; gap:12px; grid-template-columns:repeat(1, minmax(0,1fr));
}
@media (min-width:640px){ .grid{grid-template-columns:repeat(2,1fr)} }
@media (min-width:900px){ .grid{grid-template-columns:repeat(3,1fr)} }

.card-toggle{
  background:var(--card); border:1px solid var(--border); border-radius:14px; padding:14px; cursor:pointer;
  display:flex; gap:12px; align-items:flex-start; position:relative; transition:transform .05s ease;
}
.card-toggle:active{transform:scale(.99)}
.card-toggle[aria-pressed="true"]{ outline:2px solid var(--accent); }
.card-toggle .ico{font-size:22px; margin-top:2px}
.card-toggle .title{font-weight:700; margin-bottom:4px}
.card-toggle .desc{color:var(--muted); font-size:14px}

/* Chips / meta text */
.chipbar{display:flex; gap:8px; flex-wrap:wrap; margin:12px 0 6px}
.chip{background:var(--chip); border:1px solid var(--border); border-radius:999px; padding:6px 10px; font-size:13px}
.warn{color:var(--muted); font-size:13px}
.section-title{margin:18px 0 8px; font-size:18px; font-weight:800}
.divider{height:1px; background:var(--border); margin:14px 0}
.muted{color:var(--muted)}

/* Accordion */
.accordion{margin:18px 0}
.acc-item{border:1px solid var(--border); border-radius:14px; margin-bottom:12px; overflow:hidden; background:var(--card)}
.acc-head{
  display:flex; align-items:center; justify-content:space-between; padding:14px 16px; cursor:pointer; font-weight:700;
  background:var(--surface);
}
.acc-body{display:none; padding:10px 12px 14px}
.acc-item[data-open="true"] .acc-body{display:block}
.subgrid{display:grid; gap:10px; grid-template-columns:repeat(1, minmax(0,1fr))}
@media (min-width:640px){ .subgrid{grid-template-columns:repeat(2,1fr)} }

.sub-toggle{
  display:block; width:100%; text-align:left; padding:12px; border-radius:12px; border:1px solid var(--border);
  background:#fff; color:var(--text); cursor:pointer;
}
.sub-toggle[aria-pressed="true"]{background:#f0f0f0; outline:2px solid #333}

/* Report panels & lists */
.report{margin:22px 0 100px}
.panel{border:1px solid var(--border); border-radius:14px; margin-bottom:14px; overflow:hidden; background:var(--card)}
.panel h3{
  margin:0; padding:14px 16px; background:var(--surface);
  border-bottom:1px solid var(--border); font-size:16px
}
.panel .content{padding:12px}
.list{display:grid; gap:10px}
.item{border:1px solid var(--border); border-radius:12px; padding:10px; background:#fff}
.tag{
  display:inline-block; padding:2px 8px; border-radius:999px;
  background:#f3f3f3; border:1px solid var(--border); font-size:12px; color:var(--muted)
}
.sprite{display:flex; gap:10px; align-items:flex-start}

/* Sticky footer CTAs */
.sticky-footer{
  position:fixed; left:0; right:0; bottom:0; background:#f9f9f9; border-top:1px solid var(--border);
  padding:10px 16px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center;
}
.footer-cta{background:#f0f0f0; border:1px solid var(--border); color:#111; padding:10px 14px; border-radius:10px; cursor:pointer}
.footer-cta.primary{background:var(--accent); color:#fff; border:1px solid var(--accent)}
</style>
</head>

<body>
  <header>
    <div class="logo"><span class="icon">üî•</span>Ember Raven ‚Äì Your Personal Resource Navigator</div>
    <nav class="nav">
      <span>How it works</span><span>Get a Plan</span><span>About</span>
    </nav>
  </header>

  <div class="container hero">
    <h1>Plan for Wildfire - Protect What Matters</h1>
    <p class="sub">Pick what you want to work on; we‚Äôll share with you readiness knowledge, helpful assistance, and local resources tailored to your location.</p>

    <div class="address">
      <input class="input" id="addr" placeholder="Enter address (optional)" />
      <button class="btn" id="useAddr">Use Address</button>
      <button class="btn secondary" id="skipAddr">Skip</button>
    </div>
<!-- Map preview -->
<div id="gmap" style="
  height:300px;
  margin-top:12px;
  border:1px solid var(--border);
  border-radius:12px;
  filter:grayscale(1) contrast(1.05);  /* keeps it wireframe */
  background:var(--surface);
"></div>
    <div class="section-title">What do you want to focus on today? <span class="muted">(Pick up to two)</span></div>
    <div id="chips" class="chipbar" aria-live="polite"></div>

    <!-- STEP 1: Categories -->
    <div id="categories" class="grid" role="group" aria-label="Focus areas">
      <!-- Cards injected by JS -->
    </div>

    <p id="catWarn" class="warn" style="display:none">You can select up to two focus areas.</p>

    <!-- STEP 2: Accordion Wizard (hidden until categories picked) -->
    <div id="accordion" class="accordion" style="display:none" aria-label="Sub-actions wizard">
      <!-- Accordion items injected here -->
    </div>

    <!-- STEP 3: Report -->
    <div id="report" class="report" style="display:none">
      <h2 class="section-title">Your Resource Report</h2>
      <p class="muted" id="reportBasedOn"></p>

      <!-- Emergency -->
      <div class="panel" id="emergencyPanel">
        <h3>Emergency Contacts & Alerts</h3>
        <div class="content list" id="emergencyList"></div>
      </div>

      <!-- Programs -->
      <div class="panel" id="assistPanel">
        <h3>Find Assistance</h3>
        <div class="content list" id="assistList"></div>
      </div>

      <!-- Contractors -->
      <div class="panel" id="contractPanel">
        <h3>Find Contractors</h3>
        <div class="content list" id="contractList"></div>
      </div>

      <!-- Learn More -->
      <div class="panel">
        <h3>Learn More</h3>
        <div class="content list" id="learnList">
          <div class="item sprite">
            <div>‚ú®</div>
            <div><strong>Did you know?</strong><br/>60% of homes ignite from embers, not direct flames.</div>
          </div>
          <div class="item"><a href="#" class="muted">Explore all educational resources ‚Üí</a></div>
        </div>
      </div>

      <!-- Expand report -->
      <div class="panel">
        <h3>‚ûï Want to expand your report?</h3>
        <div class="content list" id="expandList"></div>
      </div>
    </div>
  </div>

  <!-- Sticky footer CTAs -->
  <div class="sticky-footer" id="footerCtas" style="display:none">
    <button class="footer-cta">Download Report (PDF)</button>
    <button class="footer-cta">Find Contractors</button>
    <button class="footer-cta">Find Assistance</button>
    <span class="muted" style="flex-basis:100%; text-align:center">Want a complete  Plan? <a href="#">Take 10-min assessment</a> or <a href="#">Book free in-person assessment</a></span>
  </div>

<script>
/* ------------------------------
   Data (placeholder mock)
   Replace with Airtable/Softr data sources later
--------------------------------*/
const CATEGORIES = [
  { id:"prepare", icon:"üß≠", title:"Prepare for Wildfire ", desc:"Plans, insurance, pets, go-bags" },
  { id:"harden", icon:"üè†", title:"Harden Your Home", desc:"Roof, gutters, vents, windows" },
  { id:"defensible", icon:"üõ°Ô∏è", title:"Create Defensible Space", desc:"Near-home landscaping & hardscape" },
  { id:"treat", icon:"üå≤", title:"Treat Your Land", desc:"Thinning, biomass cleanup, restoration" },
  { id:"infra", icon:"üö∞", title:"Improve Infrastructure", desc:"Fuel breaks, roads, irrigation" },
  { id:"neighbors", icon:"üë•", title:"Work with Neighbors", desc:"Firewise, phone trees, mapping" },
];

const SUBACTIONS = {
  harden: [
    { id:"roof", label:"Roof Cleaning", blurb:"Clear debris to reduce embers." },
    { id:"gutters", label:"Gutter Cleaning", blurb:"Remove leaves & needles." },
    { id:"vents", label:"Vent Replacement", blurb:"Install ember mesh to block sparks." },
    { id:"windows", label:"Windows & Siding", blurb:"Upgrade weak points." },
    { id:"decks", label:"Attached Decks & Fences", blurb:"Avoid ember 'fuses' to the house." },
    { id:"assessment", label:"Home Fire Risk Assessment", blurb:"DIY or professional check-up." },
  ],
  defensible: [
    { id:"zone0", label:"Clear 0‚Äì5 ft Zone", blurb:"Create an ignition buffer." },
    { id:"plants", label:"Firesafe Landscaping", blurb:"Spacing & plant choices." },
    { id:"hardscape", label:"Hardscaping", blurb:"Stone borders, gravel, patios." },
    { id:"nearTrees", label:"Trim Trees Near Home", blurb:"Remove ladder fuels." },
    { id:"fencesNear", label:"Fences & Decks Near House", blurb:"Break ember pathways." },
    { id:"smallWater", label:"Small-Scale Watering", blurb:"Irrigate defensible space." },
  ],
  prepare: [
    { id:"gobag", label:"Go Bags / Kits", blurb:"Essentials ready to go." },
    { id:"evac", label:"Evacuation Planning", blurb:"Routes & reunification." },
    { id:"ins", label:"Insurance & Docs Prep", blurb:"Coverage, belongings, critical docs." },
    { id:"alerts", label:"Emergency Alerts & Apps", blurb:"Sign up & configure." },
    { id:"pets", label:"Pets & Livestock", blurb:"Plan for animals." },
    { id:"smoke", label:"Smoke Preparedness", blurb:"Masks, air purifiers, safe room." },
  ],
  treat: [
    { id:"thin", label:"Thinning & Fuels Reduction", blurb:"Reduce fuel continuity." },
    { id:"biomass", label:"Biomass Cleanup & Removal", blurb:"Dispose or utilize safely." },
    { id:"arborist", label:"Arborist / Tree Removal", blurb:"Larger trees, hazard limbs." },
    { id:"forest", label:"Forest Management", blurb:"Long-term stewardship." },
    { id:"rx", label:"Prescribed Fire (Pro)", blurb:"Expert-guided burning." },
    { id:"native", label:"Native Plant Restoration", blurb:"Resilient plant communities." },
  ],
  infra: [
    { id:"breaks", label:"Fuel Breaks", blurb:"Strategic breaks on property." },
    { id:"ingress", label:"Ingress/Egress Planning", blurb:"Road access & safety." },
    { id:"roads", label:"Rural Road Work", blurb:"Roadside clearance." },
    { id:"irrig", label:"Irrigation Systems", blurb:"Property-scale water." },
    { id:"harvest", label:"Rainwater Harvesting", blurb:"Tanks/ponds for fire use." },
    { id:"erosion", label:"Flooding & Erosion", blurb:"Stabilize vulnerable areas." },
  ],
  neighbors: [
    { id:"firewise", label:"Firewise Community", blurb:"Start or join a group." },
    { id:"liaisons", label:"Community Liaisons", blurb:"Point people & info flow." },
    { id:"phone", label:"Phone Trees", blurb:"Fast neighbor alerts." },
    { id:"mapping", label:"Risk & Resource Mapping", blurb:"Shared situational awareness." },
    { id:"vol", label:"Volunteering", blurb:"Local orgs & events." },
  ]
};

/* (JS unchanged below this line) */

function mockEmergency() {
  return [
    { name:"Fire District", phone:"(555) 123-4567", link:"https://alerts.example.org" },
    { name:"County Sheriff", phone:"(555) 765-4321", link:"https://sheriff.example.org" },
    { name:"Local Alerts", phone:"", link:"https://signup.example.org" },
  ];
}
function mockPrograms(selectedCats, subacts) {
  const base = [
    { name:"Defensible Space Rebate", desc:"Cost-share for near-home clearing.", tags:["Deadline Sept 30","Verified Aug 2025"], match:["defensible"] },
    { name:"Home Hardening Grant", desc:"Offsets vent/window upgrades.", tags:["Open Now","Verified Aug 2025"], match:["harden"] },
    { name:"Forest Thinning Cost-Share", desc:"Per-acre support for fuels reduction.", tags:["Waitlist","Verified Aug 2025"], match:["treat"] },
    { name:"Community Mini-Grant", desc:"Neighborhood Firewise projects.", tags:["Quarterly","Verified Aug 2025"], match:["neighbors"] },
  ];
  return base.filter(p => p.match.some(m => selectedCats.includes(m)));
}
function mockContractors(selectedCats, subacts) {
  const base = [
    { name:"Evergreen Arborists", services:["Trim Trees Near Home","Arborist / Tree Removal"], area:"Jackson/Josephine", status:"Verified Aug 2025" },
    { name:"SparkSafe Roofing", services:["Roof Cleaning","Gutter Cleaning","Vent Replacement"], area:"Rogue Valley", status:"Insured" },
    { name:"ShieldScape", services:["Clear 0‚Äì5 ft Zone","Hardscaping","Fences & Decks Near House"], area:"Applegate", status:"Community Verified" },
    { name:"LandCare Fuels", services:["Thinning & Fuels Reduction","Biomass Cleanup & Removal"], area:"South County", status:"Verified Aug 2025" },
  ];
  return base.filter(c => c.services.some(s => subacts.some(sa => s.includes(sa.label))));
}
function microcardsFor(subacts){
  const picks = subacts.slice(0,2).map(sa => ({
    title: sa.label,
    why: sa.label.includes("Vent") ? "Embers enter openings > 1/8\"." : "Reduces ember ignition risk.",
    how: sa.label.includes("Vent") ? "Install ember-resistant mesh vents." : "Remove fuels and maintain clearances.",
    link: "#"
  }));
  if (picks.length===0) picks.push({title:"Firesafe Landscaping", why:"Plants near walls act like kindling.", how:"Swap bark mulch for gravel near siding.", link:"#"});
  return picks;
}
function suggestExpansions(selectedCats){
  const pool = [
    { cat:"prepare", title:"Prepare for : Go Bag" },
    { cat:"neighbors", title:"Work with Neighbors: Firewise Group" },
    { cat:"infra", title:"Improve Infrastructure: Fuel Breaks" }
  ];
  return pool.filter(s => !selectedCats.includes(s.cat)).slice(0,2);
}

/* ------------------------------
   State & rendering
--------------------------------*/
const state = { address:null, selectedCats:[], subSelections:{} };
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

function renderCategories(){
  const wrap = $("#categories");
  wrap.innerHTML = "";
  CATEGORIES.forEach(cat=>{
    const card = document.createElement("button");
    card.className="card-toggle";
    card.type="button";
    card.setAttribute("role","button");
    card.setAttribute("aria-pressed", state.selectedCats.includes(cat.id) ? "true":"false");
    card.dataset.cat = cat.id;
    card.innerHTML = `
      <div class="ico">${cat.icon}</div>
      <div>
        <div class="title">${cat.title}</div>
        <div class="desc">${cat.desc}</div>
      </div>`;
    card.addEventListener("click", ()=>toggleCategory(cat.id));
    wrap.appendChild(card);
  });
  renderChips();
}

function renderChips(){
  const chipbar = $("#chips");
  chipbar.innerHTML = state.selectedCats.map(id=>{
    const cat = CATEGORIES.find(c=>c.id===id);
    return `<span class="chip">${cat.icon} ${cat.title}</span>`;
  }).join("");
  $("#catWarn").style.display = state.selectedCats.length>2 ? "" : "none";
  $("#accordion").style.display = state.selectedCats.length>0 ? "" : "none";
  if (state.selectedCats.length>0) renderAccordion();
}

function toggleCategory(id){
  const i = state.selectedCats.indexOf(id);
  if (i>=0){ state.selectedCats.splice(i,1); }
  else{
    if (state.selectedCats.length>=2){
      $("#catWarn").style.display = "";
      return;
    }
    state.selectedCats.push(id);
  }
  $("#report").style.display="none";
  $("#footerCtas").style.display="none";
  renderCategories();
}

function renderAccordion(){
  const acc = $("#accordion");
  acc.innerHTML = "";
  state.selectedCats.forEach((catId, idx)=>{
    const cat = CATEGORIES.find(c=>c.id===catId);
    const open = idx===0 ? "true" : "false";
    const item = document.createElement("div");
    item.className="acc-item";
    item.dataset.cat = catId;
    item.setAttribute("data-open", open);

    const subs = SUBACTIONS[catId] || [];
    const subHtml = subs.map(sa=>{
      const pressed = state.subSelections[catId]?.has(sa.id) ? "true":"false";
      return `<button type="button" class="sub-toggle" role="button" aria-pressed="${pressed}" data-sub="${sa.id}">
        <strong>${sa.label}</strong><br><span class="muted">${sa.blurb}</span>
      </button>`;
    }).join("");

    item.innerHTML = `
      <div class="acc-head" role="button" aria-controls="body-${catId}" aria-expanded="${open}">
        <span>${cat.icon} ${cat.title}</span>
        <span>‚ñº</span>
      </div>
      <div id="body-${catId}" class="acc-body">
        <div class="subgrid">${subHtml}</div>
        <div class="acc-actions">
          <button class="btn small ghost" data-act="skip">Skip</button>
          <button class="btn small" data-act="continue">Continue</button>
        </div>
      </div>
    `;
    acc.appendChild(item);
  });

  $$("#accordion .acc-head").forEach(head=>{
    head.addEventListener("click", ()=>{
      const item = head.parentElement;
      const isOpen = item.getAttribute("data-open")==="true";
      item.setAttribute("data-open", isOpen?"false":"true");
    });
  });
  $$("#accordion .sub-toggle").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const catId = btn.closest(".acc-item").dataset.cat;
      const subId = btn.dataset.sub;
      state.subSelections[catId] ||= new Set();
      if (btn.getAttribute("aria-pressed")==="true"){
        btn.setAttribute("aria-pressed","false");
        state.subSelections[catId].delete(subId);
      } else {
        btn.setAttribute("aria-pressed","true");
        state.subSelections[catId].add(subId);
      }
    });
  });
  $$("#accordion .acc-actions .btn").forEach(b=>{
    b.addEventListener("click", ()=>{
      const action = b.dataset.act;
      const item = b.closest(".acc-item");
      const all = $$("#accordion .acc-item");
      const idx = all.indexOf(item);
      if (action==="continue" || action==="skip"){
        item.setAttribute("data-open","false");
        const next = all[idx+1];
        if (next){ next.setAttribute("data-open","true"); next.scrollIntoView({behavior:"smooth",block:"start"}); }
        else { generateReport(); document.getElementById("report").scrollIntoView({behavior:"smooth",block:"start"}); }
      }
    });
  });
}

function generateReport(){
  const cats = [...state.selectedCats];
  const subacts = [];
  cats.forEach(c=>{
    const ids = [...(state.subSelections[c]||[])];
    const full = (SUBACTIONS[c]||[]).filter(sa=>ids.includes(sa.id));
    subacts.push(...full);
  });

  const catTitles = cats.map(id=>CATEGORIES.find(c=>c.id===id).title).join(" + ");
  $("#reportBasedOn").textContent = `Based on your focus: ${catTitles}`;

  const emergency = mockEmergency();
  const $elist = $("#emergencyList");
  $elist.innerHTML = emergency.map(e=>`
    <div class="item">
      <strong>${e.name}</strong><br/>
      ${e.phone?`üìû ${e.phone} &nbsp;`:''}${e.link?`<a href="${e.link}">Website/Alerts ‚Üí</a>`:''}
    </div>
  `).join("");

  const programs = mockPrograms(cats, subacts);
  const $plist = $("#assistList");
  $plist.innerHTML = programs.length ? programs.map(p=>`
    <div class="item">
      <strong>üí∞ ${p.name}</strong><br/>
      <span class="muted">${p.desc}</span><br/>
      ${p.tags.map(t=>`<span class="tag">${t}</span>`).join(' ')}
      <div style="margin-top:6px"><a href="#">Apply / Learn more ‚Üí</a></div>
    </div>
  `).join("") : `<div class="item">No programs right now. Try another focus area.</div>`;

  const contr = mockContractors(cats, subacts);
  const $clist = $("#contractList");
  if (!contr.length){
    $clist.innerHTML = `<div class="item">No contractors found nearby ‚Äî try refining or another focus area.</div>`;
  } else {
    const first = contr.slice(0,10);
    $clist.innerHTML = first.map(c=>`
      <div class="item">
        <strong>üë∑ ${c.name}</strong><br/>
        Services: ${c.services.map(s=>`<span class="tag">${s}</span>`).join(' ')}<br/>
        Area: ${c.area} &nbsp; ‚Ä¢ &nbsp; Status: ${c.status}
      </div>
    `).join("");
    if (contr.length>10){
      $clist.innerHTML += `
        <div class="item">
          We found ${contr.length} contractors near you.
          <div style="margin-top:6px">
            <button class="btn small">Filter by Distance</button>
            <button class="btn small">Filter by Budget</button>
            <button class="btn small">Filter by Availability</button>
          </div>
        </div>`;
    }
  }

  const micros = microcardsFor(subacts);
  const $learn = $("#learnList");
  const extra = micros.map(m=>`
    <div class="item">
      <strong>üìö ${m.title}</strong><br/>
      <em>Why:</em> ${m.why}<br/>
      <em>How:</em> ${m.how}<br/>
      <a href="${m.link}">Read full guide ‚Üí</a>
    </div>`).join("");
  $learn.insertAdjacentHTML("afterbegin", extra);

  const sugg = suggestExpansions(cats);
  const $exp = $("#expandList");
  $exp.innerHTML = sugg.map(s=>`
    <div class="item">
      <strong>${s.title}</strong><br/>
      <button class="btn small" onclick="addExpansion('${s.cat}')">Add to Report ‚Üí</button>
    </div>
  `).join("");

  $("#report").style.display="";
  $("#footerCtas").style.display="";
}

function addExpansion(catId){
  if (!state.selectedCats.includes(catId) && state.selectedCats.length<2){
    state.selectedCats.push(catId);
    const subs = (SUBACTIONS[catId]||[]).slice(0,2).map(sa=>sa.id);
    state.subSelections[catId] = new Set(subs);
    renderCategories();
    renderAccordion();
  }
  generateReport();
}

/* ------------------------------
   Initialize
--------------------------------*/
function init(){
  renderCategories();
  $("#useAddr").addEventListener("click", ()=>{
    state.address = $("#addr").value || null;
    alert(state.address ? `Using address: ${state.address}` : "No address provided.");
  });
  $("#skipAddr").addEventListener("click", ()=>{
    state.address = null;
    alert("Continuing without an address.");
  });
}
init();
</script>
   <script>
let gmap, gmarker, geocoder, autocomplete;

function initGMap() {
  // Base map centered near Southern Oregon; change if you like
  gmap = new google.maps.Map(document.getElementById('gmap'), {
    center: { lat: 42.4, lng: -123.3 },
    zoom: 9,
    mapTypeControl: false,
    streetViewControl: false,
  });

  geocoder = new google.maps.Geocoder();

  const addrInput = document.getElementById('addr');
  if (addrInput) {
    // Places Autocomplete on your address input
    autocomplete = new google.maps.places.Autocomplete(addrInput, {
      fields: ['geometry', 'formatted_address'],
      types: ['geocode'],
    });
    autocomplete.addListener('place_changed', () => {
      const place = autocomplete.getPlace();
      if (!place.geometry || !place.geometry.location) return;
      const loc = place.geometry.location;
      showGoogleMarker(loc.lat(), loc.lng(), place.formatted_address);
      // keep your state in sync if present
      if (window.state) state.address = place.formatted_address;
    });
  }

  // Wire up your existing buttons
  document.getElementById('useAddr')?.addEventListener('click', () => {
    const addr = document.getElementById('addr')?.value?.trim();
    if (!addr) { alert('Please enter an address.'); return; }
    geocoder.geocode({ address: addr }, (results, status) => {
      if (status !== 'OK' || !results?.length) {
        alert('Address not found. Try a more specific address.');
        return;
      }
      const r = results[0];
      const loc = r.geometry.location;
      showGoogleMarker(loc.lat(), loc.lng(), r.formatted_address);
      if (window.state) state.address = r.formatted_address;
    });
  });

  document.getElementById('skipAddr')?.addEventListener('click', () => {
    gmap.setCenter({ lat: 42.4, lng: -123.3 });
    gmap.setZoom(9);
    if (gmarker) { gmarker.setMap(null); gmarker = null; }
    if (window.state) state.address = null;
  });
}

function showGoogleMarker(lat, lng, title) {
  const pos = { lat, lng };
  if (!gmarker) {
    gmarker = new google.maps.Marker({ position: pos, map: gmap, title });
  } else {
    gmarker.setPosition(pos);
    gmarker.setTitle(title);
  }
  gmap.setCenter(pos);
  gmap.setZoom(15);
}
</script>

<!-- Load Google Maps JS: replace AIzaSyByDbhJBYGR51Az_uDMhIn0J7AoXYbW5cs -->
<script async
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyByDbhJBYGR51Az_uDMhIn0J7AoXYbW5cs&libraries=places&callback=initGMap">
</script>

</body>
</html>
